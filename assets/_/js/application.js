
(function(){var __bind=function(fn,me){return function(){return fn.apply(me,arguments);};};window.Video=(function(){var muted,permalink,player,playerElement,provider,videoId;muted=null;videoId=null;player=null;provider=null;permalink=null;playerElement=document.getElementById('player');function Video(video,isMuted,setUrl){this.video=video;if(setUrl==null){setUrl=false;}
this.vimeoMessageReceived=__bind(this.vimeoMessageReceived,this);this.youtubeStateChange=__bind(this.youtubeStateChange,this);this.setVolume=__bind(this.setVolume,this);this.embed=__bind(this.embed,this);muted=isMuted;if(this.video.youtube){videoId=this.video.youtube;provider="youtube";}else if(this.video.vimeo){videoId=this.video.vimeo;provider="vimeo";}
document.title=this.video.title;this.info();this.embed();if(setUrl){this.updateURL();}}
Video.prototype.toggleMute=function(){return this.setVolume();};Video.prototype.destroy=function(){if(provider==="youtube"){return player.destroy();}};Video.prototype.info=function(){var artist,slug,title;title=document.querySelector('.video-title');artist=document.querySelector('.video-artist');slug=document.querySelector('.video-slug');title.innerHTML=this.video.title;artist.innerHTML=this.video.artist;return slug.innerHTML=this.video.slug;};Video.prototype.embed=function(){playerElement.innerHTML="";if(provider==="youtube"){return this.createYoutube();}else if(provider==="vimeo"){return this.createVimeo();}};Video.prototype.updateURL=function(){if(window.history&&window.history.pushState){return window.history.pushState({},document.title,this.video.url);}};Video.prototype.setVolume=function(){if(!muted){if(provider==="youtube"){player.setVolume(0);}else{this.post("setVolume","0");}}else{if(provider==="youtube"){player.setVolume(100);}else{this.post("setVolume","1");}}
return muted=!muted;};Video.prototype.videoEnded=function(){return $(window).trigger("videoEnded");};Video.prototype.createYoutube=function(){var ytWrap;ytWrap=document.createElement("div");playerElement.appendChild(ytWrap);return player=new YT.Player(ytWrap,{videoId:videoId,origin:window.location.origin,rel:0,playerVars:{showinfo:0,color:"white",rel:0,autoplay:1,iv_load_policy:3,controls:0},events:{onReady:this.youtubeReady,onStateChange:this.youtubeStateChange}});};Video.prototype.youtubeReady=function(){return player.setVolume(muted?0:100);};Video.prototype.youtubeStateChange=function(e){if(e.data===YT.PlayerState.ENDED){return this.videoEnded();}};Video.prototype.post=function(action,value){var data,url;data={method:action};url=player.getAttribute("src").split("?")[0];if(value){data.value=value;}
return player.contentWindow.postMessage(JSON.stringify(data),url);};Video.prototype.createVimeo=function(){var iframe,iframeURL;iframeURL="http://player.vimeo.com/video/"+videoId+"?api=1&player_id=vimeoplayer&color=ffffff&autoplay=1&byline=0&portrait=0&title=0";iframe=document.createElement("iframe");iframe.setAttribute("src",iframeURL);iframe.setAttribute("frameborder",0);iframe.setAttribute("width",500);iframe.setAttribute("height",281);iframe.setAttribute("webkitAllowFullScreen",true);iframe.setAttribute("mozallowfullscreen",true);iframe.setAttribute("allowFullScreen",true);playerElement.appendChild(iframe);player=iframe;return this.setupVimeoEvents();};Video.prototype.setupVimeoEvents=function(){return window.addEventListener("message",this.vimeoMessageReceived,false);};Video.prototype.vimeoMessageReceived=function(e){var data,volume;data=JSON.parse(e.data);switch(data.event){case"ready":volume=muted?"0":"1";this.post("addEventListener","finish");return this.post("setVolume",volume);case"finish":return this.videoEnded();}};return Video;})();}).call(this);(function(){window.App=(function(){var currentVideo,currentVideoIndex,muted;muted=false;currentVideo=null;currentVideoIndex=null;function App(createFirstVideo){var self;if(createFirstVideo==null){createFirstVideo=true;}
self=this;$.ajax({url:'/videos-data.js',dataType:'JSON'}).done(function(data){var path,slug;try{self.videos=JSON.parse(data);}catch(_error){self.videos=data;}
self.shuffledVideos=self.shuffleArray(self.videos.concat([]));if(createFirstVideo){path=window.location.pathname.split('/');if(path.indexOf('videos')>=0){slug=path[path.indexOf('videos')+1];self.createVideo(self.getVideoIndexBySlug(slug));self.hideVideos();}else{self.createVideo(0);}}
self.attachEvents();return self.createNav();});}
App.prototype.getVideoIndexBySlug=function(slug){var item,_i,_len,_ref;_ref=this.shuffledVideos;for(_i=0,_len=_ref.length;_i<_len;_i++){item=_ref[_i];if(item.slug===slug){return this.shuffledVideos.indexOf(item);}}};App.prototype.createNav=function(){var artist,frag,href,img,title,video,videosEl,_i,_len,_ref;videosEl=document.querySelector('.videos');frag=document.createDocumentFragment();_ref=this.videos;for(_i=0,_len=_ref.length;_i<_len;_i++){video=_ref[_i];href=document.createElement('a');href.setAttribute('href',video.url);href.setAttribute('data-slug',video.slug);href.classList.add('video-link');if(video.artist){artist=document.createElement('span');artist.classList.add('artist');artist.innerHTML=video.artist;href.appendChild(artist);}
title=document.createElement('span');title.classList.add('title');title.innerHTML=video.title;href.appendChild(title);if(video.youtube){img=document.createElement('img');img.setAttribute('src','http://img.youtube.com/vi/'+video.youtube+'/mqdefault.jpg');img.setAttribute('height',100);href.appendChild(img);}
frag.appendChild(href);}
return videosEl.appendChild(frag);};App.prototype.attachEvents=function(){var self,_this=this;self=this;$(window).on("videoEnded",function(){return _this.videoEnded();});$(document).on('click','.video-link',function(e){var index,slug;e.preventDefault();slug=this.getAttribute('data-slug');index=self.getVideoIndexBySlug(slug);self.createVideo(index,true);return self.hideVideos();});$("#js-mute").on("click",function(){currentVideo.toggleMute();muted=!muted;return this.classList.toggle("is-muted");});$('.hide-videos').on('click',function(){return self.hideVideos();});$('.show-videos').on('click',function(){document.body.classList.remove('is-hiding-menu');return document.body.classList.remove('is-showing-info');});return $('.show-info').on('click',function(){return document.body.classList.toggle('is-showing-info');});};App.prototype.hideVideos=function(){return document.body.classList.add('is-hiding-menu');};App.prototype.createVideo=function(i,setUrl){if(setUrl==null){setUrl=false;}
if(currentVideo){currentVideo.destroy();}
currentVideo=new Video(this.shuffledVideos[i],muted,setUrl);return currentVideoIndex=i;};App.prototype.nextVideo=function(){return this.createVideo(currentVideoIndex+1);};App.prototype.videoEnded=function(){if(currentVideoIndex===this.shuffledVideos.length-1){return this.createVideo(0);}else{return this.nextVideo();}};App.prototype.shuffleArray=function(arr){var i,j,len,temp;i=void 0;temp=void 0;j=void 0;len=arr.length;i=0;while(i<len){j=~~(Math.random()*(i+1));temp=arr[i];arr[i]=arr[j];arr[j]=temp;i++;}
return arr;};return App;})();}).call(this);(function(){window.onYouTubeIframeAPIReady=function(){var app;return app=new App();};}).call(this);